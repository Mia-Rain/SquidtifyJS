<button onclick="pause()">Pause</button>
<button onclick="resume()">Resume</button>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script>
var urlParams = new URLSearchParams(window.location.search);
console.log(urlParams.get('code'));
var code = urlParams.get('code');
const CLID = sessionStorage.getItem('CLID');
const CLSEC = sessionStorage.getItem('CLSEC');
$.ajax({
            type: 'POST',
            url: "https://accounts.spotify.com/api/token",
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            dataType: 'json',
            data: { 'client_id': CLID, 'client_secret': CLSEC, 'redirect_uri': 'https://www.thatgeekyweeb.is-dummy-thi.cc/SquidtifyJS/callback/', code, 'grant_type': "authorization_code" },
            		success: function (response, data) {
                	console.log(response);
			console.log(data);
                	sessionStorage.setItem('refresh_token', response.refresh_token);
	        }
});
window.refresh_token = sessionStorage.getItem('refresh_token');

function auth(){
	$.ajax({
  	      type: 'POST',
    	      url: 'https://accounts.spotify.com/api/token',
      	      contentType: 'application/x-www-form-urlencoded',
              data: { 'client_id': sessionStorage.getItem('CLID'), 'client_secret': sessionStorage.getItem('CLSEC'), 'grant_type': 'refresh_token', 'refresh_token': window.refresh_token },
      	      success: function (response, data) {
			sessionStorage.setItem('access_token', response.access_token);
    	      }
	});
	window.access_token = sessionStorage.getItem('access_token');
}

auth();
function device_get(){
auth();
$.ajax({
	    type: 'GET',
	    url: "https://api.spotify.com/v1/me/player/devices", 
            contentType: 'application/x-www-form-urlencoded',
            Accept: 'application/json',
            data: { 'access_token': window.access_token },
            success: function (response, data) {
               sessionStorage.setItem('device', response.devices[0].id);
            }
})
window.device = sessionStorage.getItem('device');
}
function pause() {
device_get();
$.ajax({
	    type: 'PUT',
	    url: "https://api.spotify.com/v1/me/player/pause",
            data: { device_id: window.device },
            headers: {
           	 Authorization: 'Bearer ' + window.access_token,
           	 'Accept': 'application/json',
            	'Content-Type': 'application/json'
            },
            success: function () {
            		console.log('Paused');
            }
})
}
function resume(){
device_get();
$.ajax({
	    type: 'PUT',
	    url: "https://api.spotify.com/v1/me/player/play",
            data: {},
            headers: {
            	Authorization: 'Bearer ' + window.access_token,
            	'Accept': 'application/json',
            	'Content-Type': 'application/json'
            },
            success: function () {
            		console.log('Resumed');
            }
})
}

auth();
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    sessionStorage.setItem('uri', response.item.id)
  }
})
uri = sessionStorage.getItem('uri');
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/tracks/' + uri,
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    div = document.createElement("div");
    div.classList.add("frame");
    div.innerHTML = '<img class="center" id="album-image" src=' + response.album.images[0].url + '>';
    document.body.appendChild(div);
    sessionStorage.setItem('img', response.album.images[0].url);
  }
})

setInterval(function() {
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    sessionStorage.setItem('uri', response.item.id)
  }
})
uri = sessionStorage.getItem('uri');
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/tracks/' + uri,
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
  	if ( response.album.images[0].url != document.getElementById("album-image").src) {
      document.getElementById("album-image").src = response.album.images[0].url;
    }
  }
})}, 3000);
</script>
<style>
body {
    background: radial-gradient(circle, rgba(177,173,246,1) 0%, rgba(181,140,223,1) 25%, rgba(248,151,255,1) 75%, rgba(255,187,215,1) 100%);
}
.center {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 500px;
   height: 500px;
   margin-top: -250px; /* Half the height */
   margin-left: -250px; /* Half the width */
}
.frame {
    height: 560px; /* Can be anything */
    position: relative;
    margin-top: 50px;
}
</style>
