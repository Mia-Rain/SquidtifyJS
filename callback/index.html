<!DOCTYPE html> 
<html lang="en"> 
<head> 
<title>Simple Music Player</title> 
<!-- Load FontAwesome icons -->
<link rel="stylesheet"
		href= 
"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"> 

<!-- Load the custom CSS style file -->
</head> 
<body>
<div class="player"> 

	<!-- Define the section for displaying details -->
	<div class="details"> 
	<div id="track-art" class="track-art"></div>
	<div id="track-name" class="track-name">Track Name</div> 
	<div id="track-artist" class="track-artist">Track Artist</div> 
	</div> 

	<!-- Define the section for displaying track buttons -->
	<div class="buttons"> 
	<div class="prev-track" onclick="prevTrack()"> 
		<i class="fa fa-step-backward fa-2x"></i> 
	</div> 
	<div id="playback" class="playpause-track" onclick="pauseplay()"> 
		<i class="fa fa-play-circle fa-5x"></i> 
	</div> 
	<div class="next-track" onclick="nextTrack()"> 
		<i class="fa fa-step-forward fa-2x"></i> 
	</div> 
	</div> 

	<!-- Define the section for displaying the seek slider-->
	<div class="slider_container"> 
	<div class="current-time">00:00</div> 
	<input type="range" min="1" max="100"
		value="0" class="seek_slider" onchange="seekTo()"> 
	<div class="total-duration">00:00</div> 
	</div>

	<!-- Define the section for displaying the volume slider-->
	<div class="slider_container"> 
	<i class="fa fa-volume-down"></i> 
	<input type="range" min="1" max="100"
		value="99" class="volume_slider" onchange="setVolume()"> 
	<i class="fa fa-volume-up"></i> 
	</div> 
</div> 
</body> 
</html> 
<style>
body { 
background: radial-gradient(circle, rgba(177,173,246,1) 0%, rgba(181,140,223,1) 25%, rgba(248,151,255,1) 75%, rgba(255,187,215,1) 100%);
transition: background-color .5s; 
}

/* Using flex with the column direction to 
align items in a vertical direction */
.player { 
height: 95vh; 
display: flex; 
align-items: center; 
flex-direction: column; 
justify-content: center; 
} 

.details { 
display: flex; 
align-items: center; 
flex-direction: column; 
justify-content: center; 
margin-top: 25px; 
} 

.track-art { 
margin: 25px; 
height: 250px; 
width: 250px; 
background-size: cover; 
background-position: center; 
border-radius: 10px; 
} 

/* Changing the font sizes to suitable ones */
.now-playing { 
font-size: 1rem; 
} 

.track-name { 
font-size: 3rem; 
} 

.track-artist { 
font-size: 1.5rem; 
} 

/* Using flex with the row direction to 
align items in a horizontal direction */
.buttons { 
display: flex; 
flex-direction: row; 
align-items: center; 
} 

.playpause-track, 
.prev-track, 
.next-track { 
padding: 25px; 
opacity: 0.8; 

/* Smoothly transition the opacity */
transition: opacity .2s; 
} 

/* Change the opacity when mouse is hovered */
.playpause-track:hover, 
.prev-track:hover, 
.next-track:hover { 
opacity: 1.0; 
} 

/* Define the slider width so that it scales properly */
.slider_container { 
width: 75%; 
max-width: 400px; 
display: flex; 
justify-content: center; 
align-items: center; 
} 

/* Modify the appearance of the slider */
.seek_slider, .volume_slider { 
-webkit-appearance: none; 
-moz-appearance: none; 
appearance: none; 
height: 5px; 
background: black; 
opacity: 0.7; 
-webkit-transition: .2s; 
transition: opacity .2s; 
} 
  

/* Modify the appearance of the slider thumb */
.seek_slider::-webkit-slider-thumb, 
.volume_slider::-webkit-slider-thumb { 
-webkit-appearance: none; 
-moz-appearance: none; 
appearance: none; 
width: 15px; 
height: 15px; 
background: white; 
cursor: pointer; 
border-radius: 50%; 
} 

/* Change the opacity when mouse is hovered */
.seek_slider:hover, 
.volume_slider:hover { 
opacity: 1.0; 
} 

.seek_slider { 
width: 60%; 
} 

.volume_slider { 
width: 30%; 
} 

.current-time, 
.total-duration { 
padding: 10px; 
} 

i.fa-volume-down, 
i.fa-volume-up { 
padding: 10px; 
} 

/* Change the mouse cursor to a pointer 
when hovered over */
i.fa-play-circle, 
i.fa-pause-circle, 
i.fa-step-forward, 
i.fa-step-backward { 
cursor: pointer; 
}
</style>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script>
var urlParams = new URLSearchParams(window.location.search);
console.log(urlParams.get('code'));
var code = urlParams.get('code');
const CLID = sessionStorage.getItem('CLID');
const CLSEC = sessionStorage.getItem('CLSEC');
$.ajax({
            type: 'POST',
            url: "https://accounts.spotify.com/api/token",
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            dataType: 'json',
            data: { 'client_id': CLID, 'client_secret': CLSEC, 'redirect_uri': 'https://www.thatgeekyweeb.is-dummy-thi.cc/SquidtifyJS/callback/', code, 'grant_type': "authorization_code" },
            		success: function (response, data) {
                	console.log(response);
			console.log(data);
                	sessionStorage.setItem('refresh_token', response.refresh_token);
	        }
});
window.refresh_token = sessionStorage.getItem('refresh_token');
function auth(){
	$.ajax({
  	      type: 'POST',
    	      url: 'https://accounts.spotify.com/api/token',
      	      contentType: 'application/x-www-form-urlencoded',
              data: { 'client_id': sessionStorage.getItem('CLID'), 'client_secret': sessionStorage.getItem('CLSEC'), 'grant_type': 'refresh_token', 'refresh_token': window.refresh_token },
      	      success: function (response, data) {
			sessionStorage.setItem('access_token', response.access_token);
    	      }
	});
	window.access_token = sessionStorage.getItem('access_token');
}

function device_get(){
auth();
$.ajax({
	    type: 'GET',
	    url: "https://api.spotify.com/v1/me/player/devices", 
            contentType: 'application/x-www-form-urlencoded',
            Accept: 'application/json',
            data: { 'access_token': window.access_token },
            success: function (response, data) {
               sessionStorage.setItem('device', response.devices[0].id);
            }
})
window.device = sessionStorage.getItem('device');
}
function pause() {
device_get();
$.ajax({
	    type: 'PUT',
	    url: "https://api.spotify.com/v1/me/player/pause",
            data: { device_id: window.device },
            headers: {
           	 Authorization: 'Bearer ' + window.access_token,
           	 'Accept': 'application/json',
            	'Content-Type': 'application/json'
            },
            success: function () {
            		console.log('Paused');
            }
})
}
function resume(){
device_get();
$.ajax({
	    type: 'PUT',
	    url: "https://api.spotify.com/v1/me/player/play",
            data: {},
            headers: {
            	Authorization: 'Bearer ' + window.access_token,
            	'Accept': 'application/json',
            	'Content-Type': 'application/json'
            },
            success: function () {
            		console.log('Resumed');
            }
})
}
function pauseplay() {
auth();
	$.ajax({
		type: 'GET',
	  url: 'https://api.spotify.com/v1/me/player',
	  headers: {
	           	 Authorization: 'Bearer ' + window.access_token,
	            },
	  success: function (response, data) {
	   if ( response.is_playing == true  ) {
       		sessionStorage.setItem('playback', 'playing');
   	   } else if ( response.is_playing == false ) {
       		sessionStorage.setItem('playback', 'paused');}
   	   } 
});
if ( sessionStorage.getItem('playback') == 'playing' ) {
      pause();
      sessionStorage.setItem('replay', 'paused');
} else if ( sessionStorage.getItem('playback') == 'paused' ) {
      resume();
      sessionStorage.setItem('replay', 'resumed');
    }
}
function previousTrack() {
device_get();
$.ajax({
  type: 'post',
  url: 'https://api.spotify.com/v1/me/player/previous',
  data: { device_id: window.device },
  headers: {
  'Authorization': ' Bearer ' + window.access_token
  },
  success: function (response, data) {
	console.log(data)
  }
});
}
function nextTrack() {
device_get();
$.ajax({
  type: 'post',
  url: 'https://api.spotify.com/v1/me/player/next',
  data: { device_id: window.device },
  headers: {
  'Authorization': ' Bearer ' + window.access_token
  },
  success: function (response, data) {
	console.log(data)
  }
});
}
auth();
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    sessionStorage.setItem('uri', response.item.id)
  }
})
uri = sessionStorage.getItem('uri');
setInterval(function() {
$.ajax({
  type: 'POST',
  url: 'https://accounts.spotify.com/api/token',
  contentType: 'application/x-www-form-urlencoded',
  data: { 'client_id': sessionStorage.getItem('CLID'), 'client_secret': sessionStorage.getItem('CLSEC'), 'grant_type': 'refresh_token', 'refresh_token': window.refresh_token },
  success: function (response, data) {
	sessionStorage.setItem('access_token', response.access_token);
  }
});
window.access_token = sessionStorage.getItem('access_token');
uri = sessionStorage.getItem('uri');

$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
  'Accept': 'application/json',
  'Content-Type': 'application/json',
  'Authorization': ' Bearer ' + window.access_token
  },
  success: function (response, data) {
  	if ( response != undefined && response.is_playing != false ){
       sessionStorage.setItem('playing', true);
  	} else {
       sessionStorage.setItem('playing', false);
    }
  }
});
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    sessionStorage.setItem('uri', response.item.id)
  }
})
uri = sessionStorage.getItem('uri');
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/tracks/' + uri,
  headers: {
           	 Authorization: 'Bearer ' + window.access_token,
            },
  success: function (response, data) {
    if ( sessionStorage.getItem('playing') != false && sessionStorage.getItem('playing') == "true" ) {
      document.getElementById("track-art").style.backgroundImage = '';
      document.getElementById("track-art").style.backgroundImage = 'URL("' + response.album.images[0].url + '")';
    }
	 }
})
$.ajax({
  type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
  'Accept': 'application/json',
  'Content-Type': 'application/json',
  'Authorization': ' Bearer ' + window.access_token
  },
  success: function (response, data) {
	if ( document.getElementById("track-name").innerHTML != response.item.name) {
	document.getElementById("track-name").innerHTML = response.item.name 
	}
  }
})
$.ajax({
	type: 'GET',
  url: 'https://api.spotify.com/v1/me/player',
  headers: {
  'Accept': 'application/json',
  'Content-Type': 'application/json',
  'Authorization': ' Bearer ' + window.access_token
  },
  success: function (response, data) {
	if ( document.getElementById("track-artist").innerHTML != response.item.artists[0].name) {
	document.getElementById("track-artist").innerHTML = response.item.artists[0].name
	}
  }
})
}, 3000);
</script>
